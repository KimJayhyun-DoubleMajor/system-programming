# 리눅스 시스템 프로그래밍의 개요

## 1. 리눅스의 구조
### 1. 커널
> 리눅스의 핵심
- 커널의 역할
  - 프로세스
    - 프로세스가 일을 잘 할 수 있도록 지원
  - 메모리
    - 연산의 처리, 결과를 메모리에 저장
    - 프로세스는 임시적인 메모리가 있어야 함
    - 메모리의 주소관리, 제어관리
  - 파일 시스템
    - 파일이라는 시스템 구조를 활용
    - USB, 디스크, 프린터 등을 하드웨어를 모두 파일로 바라보면서 출력
    - 커널을 통해서 기타 외부 장치를 제어하거나 조절하기 위해서는 파일 형식을 알아야 함
    - 리눅스에서는 커널에 관련된 부분을 직접적으로 제어해야 함
    - 파일 시스템에 관련된 구조, 형식을 잘 알아야 함
  - 장치 관리
    - 커널을 통해서 모든 하드웨어를 사용
  - 컴퓨터의 모든 자원 초기화 및 제어 기능
- 커널은 C 언어로 개발됨 : C 언어로 커널을 접근할 수 있음
  - 커널의 역할을 C 언어로 구현 가능

### 2. 쉘
> 사용자 인터페이스

> 커널에 접근할 수 있는 방법
- 쉘의 역할
  - 명령 해석
    - 사람의 언어 > 쉘 > 하드웨어의 언어
  - 명령 해독
    - 사람의 언어 < 쉘 < 하드웨어의 언어
  - 프로그래밍 기능
    - 쉘을 통해서 커널에 접근할 수 있는 프로그래밍
    - 그 프로그래밍으로 하드웨어 제어

### 3. Bash 쉘
> 리눅스 기본 쉘
- 응용 프로그램
  - 각종 프로그래밍 개발 도구
    - gcc
  - 문서 편집 도구
    - vi
  - 네트워크 관련 도구 등

### 4.리눅스 시스템 구조
- 응용 프로그램
  - 응용 프로그램 <> 쉘
  - 작업
- 쉘   
  - 쉘 <> 커널
  - 작업 > 기계어로 번역
- 커널
  - 커널 <> 하드웨어
  - 프로세스, 메모리, 파일 관리

## 2. 유닉스/리눅스 시스템 프로그래밍의 정의
- 유닉스/리눅스에서 저공하는 시스템 호출을 사용해 프로그램을 작성
  - 시스템 호출은 2 가지 방법
    - 시스템 호출(시스템 콜)로 직접 처리
    - 시스템 함수를 활용
  - 커널을 접근하기 위해 `시스템 호출`을 사용

### 1. 시스템 호출
- 유닉스 시스템이 제공하는 서비스를 이용
- 프로그램을 작성할 수 있도록 제공하는 프로그래밍 인터페이스
- 기본적인 형태는 C 언어의 함수 형태로 제공
  > **리턴값 = 시스템 호출명(인자 1, 인자 2, ...);**

### 2. 라이브러리 함수
> 미리 컴파일된 함수들을 묶어서 제공하는 특수한 파일 형태
- 자죠 사용하는 기능을 독립적으로 분리하여 구현
  - 프로그램의 개발과 디버깅이 쉬움
  - 컴파일이 좀 더 빨라짐
- `/lib`, `/usr/lib`에 위치
  - `lib*.a` 또는 `lib*.so` 형태로 제공

### 3. 시스템 호출과 라이브러리 함수 비교 1
시스템 호출 | 라이브러리 함수 |
:---: | :---:|
커널의 해당 서비스 모듈을 직접 호출하여 작업하고 결과를 리턴 | 일반적으로 커널 모듈을 직접 호출 안 함
`리턴값 = 호출명(...)` | 시스템 호출과 리턴값

- 구조

### 4. man
> 리눅스가 제공하는 명령의 사용법을 보여줌

### 5. 시스템 호출과 라이브러리 함수 비교 2
시스템 호출 | 라이브러리 함수 |
:---: | :---:|
`man` 페이지가 `섹션 2`에 속함 (`man open`) | `man` 페이지가 `섹션 3`에 속함 (`man fopen`)

[메뉴얼 단락으로 `man` 페이지 섹션 확인 ](https://ko.wikipedia.org/wiki/Man_page#%EB%A7%A4%EB%89%B4%EC%96%BC_%EB%8B%A8%EB%9D%BD)

### 6. 시스템 호출과 라이브러리 함수 비교 3 (중요)
1. _**시스템 호출의 오류 처리방법**_ 
  - 성공하면 `0`
  - 실패하면 `-1`
  - 전역변수 `errno`에 오류 코드 저장
    - `man` 페이지에서 코드값 확인 가능
  
  ```c
  // ex1-1.c
  #include <unistd.h>
  #include <stdio.h>

  extern int errno;

  int main(void){
    if (access("uni.txt", F_OK) ==-1) { // 실패 시 -1 리턴
      printf("errno=%d\n", errno); 
    }
    return 0;
  }
  ```
  ```bash
  $ ex1-1.out
  
  errno=2

  $ sudo vi /usr/include/sys/errno.h
  ```
  ``` c
  /* `/usr/include/sys/errno.h` */ 
  ---
  /*
  * Error codes 
  */
  
  #define EPERM 1 /* Not super-user */
  #define ENOENT  2 /* No such file or directory */
  ---
  ```

2. 라이브러리 함수의 오류 처리방법
   - 실패하면 `Null`, 함수의 리턴이 int형이면 `-1`
   - `errno` 변수에 오류 코드 지정
  ```c
  // ex1-1.c
  #include <stdlib.h>
  #include <stdio.h>

  extern int errno;

  int main(void){
    File *fp;

    if ((fp = fopen("unix.txt", "r")) == NULL) { // 오류 발생
      printf("errno=%d\n", errno);    
      exit(1);
    }
    fclose(fp);

    return 0;
  }
  ```
  ```bash
  $ ex1-1.out

  errno=2 # man fopen에서 확인
  ```

## 3. C 언어 개요
### 1. C언어
- 1972 년 데니스 리치가 B 언어에서 C 언어로 개발
- 뛰어난 기능과 융통성을 제공
- 대부분의 시스템 소프트웨어를 구현하는 언어
- 고급언어이지만, 저급언어처럼 비트나 바이트 처리와 포인터에 의한 주소 처리
- 임베디드, IoT, 드론, 제조, 기계 등 다양한 산업에서 사용

### 2. Why C 언어
- 리눅스의 대부분이 C 언어
- 리눅스 환경의 대부분의 애플리케이션을 C 언어

### 3. 참고 자료

사이트명 | 설명
:---: | :---:
http://gcc.gnu.org | gcc매뉴얼과프로그램제공
http://www.gnu.org/software/make | make매뉴얼과프로그램제공
http://www.gnu.org/software/gdb | gdb매뉴얼과프로그램제공
http://www.tldp.org | 리눅스와관련된기술자료들을제공
http://kldp.org | 리눅스와관련된기술자료들을제공(한글)
http://lug.or.kr | 리눅스팁을제공,Q&A코너운영